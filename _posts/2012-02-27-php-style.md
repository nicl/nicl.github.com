---
layout: post
category: blog
title: PHP with style
permalink: /2012/02/27/php-style.html
---

Basics
-------------

Code  can be specification correct but still suck. For example, whitespace is largely optional in most programming languages (Python being a notable exception), but ignoring whitespace can result in code which is evidently bad:

{% highlight php %}
$var=$test?$a:$b;
{% endhighlight %}

Other 'layout' concerns are indenting and the use of line-breaks to increase legibility. The important thing is to be consistent. You should probably adopt the coding standards of a well-known PHP project, either a framework like Symfony 2, or a CMS like Drupal.

The importance of Subsetting
----------------------------

A fuller understanding of programming style extends beyond the placement of characters; good style requires an awareness of which language features to use and which to avoid. Some language features are more error-prone than others, and if an alternative exists which is less error-prone we are better off using that instead. This practice, of subsetting a language, is advocated strongly by, among others, Douglas Crockford (well-known in the Javascript world).

Real-life example
-----------------

What kinds of things are error-prone or 'dangerous'? Consider the following example:

{% highlight php %}
if ($x = CONSTANT) { ...
{% endhighlight %}

This code executes a code block if CONSTANT is true, and assigns the value of CONSTANT to the variable x.

But the code could just as easily have been intended to be:

{% highlight php %}
if ($x == CONSTANT) { ...
{% endhighlight %}

Now I am executing the code block if x and CONSTANT are equal. The behaviour has changed completely!

People omit the second '=' by accident all the time. By adopting the rule of avoiding the first-case style (assignment within conditional statements) you remove a source of ambiguity and errors in your code. Now, if you or someone else, when reading your code later, sees the first case, they know it is an error and can correct it.

Say we had intended to write the second form, there are still a few more problems with the code above. In PHP '==' itself can be considered 'dangerous' because it compares values after coercing types according to rules which are [fantastically complicated](http://www.php.net/manual/en/types.comparisons.php) and unintuitive. Instead, we should use:

{% highlight php %}
if ($x === CONSTANT) { ...
{% endhighlight %}

(We might have to do some type conversion beforehand now, but the code can be easily read and understood.)

One last thing, why not place the constant on the left-hand-side? That way, if we do forget some of the '='s in our boolean expression, we'll immediately get a fatal error indicating our mistake. Our end result becomes:

{% highlight php %}
if (CONSTANT === $x) { ...
{% endhighlight %}

Some general rules
------------------

Many of the features identified below as 'dangerous' - meaning to be avoided - mirror examples given by Douglas Crockford for the Javascript language. And again, to reiterate, the point isn't that these features aren't useful, but that they are *always* error-prone, and we can achieve the same purposes through other (safer) means. (Note that, unless otherwise stated, the points below indicate features which should be *avoided*.)

* \+\+ and - -
* fall-throughs in switch statements
* \=\= and \!\=
* assignment (=) within if and other expressions
* eval (and its cousins)
* globals (globals are evil!)
* the ternary operator in general, and particular avoid nesting ternary operators(!)
* massive blocks of html
* massive blocks of sql queries
* falsy values

All of the above make code harder to read, and errors harder to spot.

And some things you *should* do:

* *do* follow the maxim of one statement per line max
* *do* always use blocks in structured statements, even where optional
* *do* differentiate between function invocation and control structures with whitespace, e.g. placing spaces between if and opening parens '('